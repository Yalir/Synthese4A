<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>protocols/gg/lib/common.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('common_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">protocols/gg/lib/common.c</div>  </div>
</div>
<div class="contents">
<a href="common_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* $Id: common.c 1101 2011-05-05 21:17:28Z wojtekka $ */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> *  (C) Copyright 2001-2002 Wojtek Kaniewski &lt;wojtekka@irc.pl&gt;</span>
<a name="l00005"></a>00005 <span class="comment"> *                          Robert J. Woźny &lt;speedy@ziew.org&gt;</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> *  This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment"> *  it under the terms of the GNU Lesser General Public License Version</span>
<a name="l00009"></a>00009 <span class="comment"> *  2.1 as published by the Free Software Foundation.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> *  GNU Lesser General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *  You should have received a copy of the GNU Lesser General Public</span>
<a name="l00017"></a>00017 <span class="comment"> *  License along with this program; if not, write to the Free Software</span>
<a name="l00018"></a>00018 <span class="comment"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307,</span>
<a name="l00019"></a>00019 <span class="comment"> *  USA.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00027"></a>00027 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;sys/types.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#  include &lt;sys/ioctl.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#  include &lt;sys/socket.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#  include &lt;netinet/in.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#  include &lt;arpa/inet.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#  ifdef sun</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#    include &lt;sys/filio.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#  endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;netdb.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="libgadu_8h.html" title="Główny plik nagłówkowy biblioteki.">libgadu.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00064"></a>00064 <span class="keywordtype">char</span> *gg_vsaprintf(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, va_list ap)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066         <span class="keywordtype">int</span> size = 0;
<a name="l00067"></a>00067         <span class="keywordtype">char</span> *buf = NULL;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#ifdef GG_CONFIG_HAVE_VA_COPY</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>        va_list aq;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         va_copy(aq, ap);
<a name="l00073"></a>00073 <span class="preprocessor">#else</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#  ifdef GG_CONFIG_HAVE___VA_COPY</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>        va_list aq;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         __va_copy(aq, ap);
<a name="l00078"></a>00078 <span class="preprocessor">#  endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="preprocessor">#ifndef GG_CONFIG_HAVE_C99_VSNPRINTF</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>        {
<a name="l00083"></a>00083                 <span class="keywordtype">int</span> res;
<a name="l00084"></a>00084                 <span class="keywordtype">char</span> *tmp;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086                 size = 128;
<a name="l00087"></a>00087                 <span class="keywordflow">do</span> {
<a name="l00088"></a>00088                         size *= 2;
<a name="l00089"></a>00089                         <span class="keywordflow">if</span> (!(tmp = realloc(buf, size + 1))) {
<a name="l00090"></a>00090                                 free(buf);
<a name="l00091"></a>00091                                 <span class="keywordflow">return</span> NULL;
<a name="l00092"></a>00092                         }
<a name="l00093"></a>00093                         buf = tmp;
<a name="l00094"></a>00094                         res = vsnprintf(buf, size, format, ap);
<a name="l00095"></a>00095                 } <span class="keywordflow">while</span> (res == size - 1 || res == -1);
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 <span class="preprocessor">#else</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>        {
<a name="l00099"></a>00099                 <span class="keywordtype">char</span> tmp[2];
<a name="l00100"></a>00100 
<a name="l00101"></a>00101                 <span class="comment">/* libce Solarisa przy buforze NULL zawsze zwracają -1, więc</span>
<a name="l00102"></a>00102 <span class="comment">                 * musimy podać coś istniejącego jako cel printf()owania. */</span>
<a name="l00103"></a>00103                 size = vsnprintf(tmp, <span class="keyword">sizeof</span>(tmp), format, ap);
<a name="l00104"></a>00104                 <span class="keywordflow">if</span> (!(buf = malloc(size + 1)))
<a name="l00105"></a>00105                         <span class="keywordflow">return</span> NULL;
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107 <span class="preprocessor">#endif</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a>00109 <span class="preprocessor">#ifdef GG_CONFIG_HAVE_VA_COPY</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>        vsnprintf(buf, size + 1, format, aq);
<a name="l00111"></a>00111         va_end(aq);
<a name="l00112"></a>00112 <span class="preprocessor">#else</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="preprocessor">#  ifdef GG_CONFIG_HAVE___VA_COPY</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>        vsnprintf(buf, size + 1, format, aq);
<a name="l00115"></a>00115         va_end(aq);
<a name="l00116"></a>00116 <span class="preprocessor">#  else</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>        vsnprintf(buf, size + 1, format, ap);
<a name="l00118"></a>00118 <span class="preprocessor">#  endif</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>
<a name="l00121"></a>00121         <span class="keywordflow">return</span> buf;
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00136"></a>00136 <span class="keywordtype">char</span> *gg_saprintf(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138         va_list ap;
<a name="l00139"></a>00139         <span class="keywordtype">char</span> *res;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         va_start(ap, format);
<a name="l00142"></a>00142         res = gg_vsaprintf(format, ap);
<a name="l00143"></a>00143         va_end(ap);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         <span class="keywordflow">return</span> res;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00160"></a>00160 <span class="keywordtype">char</span> *gg_get_line(<span class="keywordtype">char</span> **ptr)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162         <span class="keywordtype">char</span> *foo, *res;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordflow">if</span> (!ptr || !*ptr || !strcmp(*ptr, <span class="stringliteral">&quot;&quot;</span>))
<a name="l00165"></a>00165                 <span class="keywordflow">return</span> NULL;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         res = *ptr;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="keywordflow">if</span> (!(foo = strchr(*ptr, <span class="charliteral">&#39;\n&#39;</span>)))
<a name="l00170"></a>00170                 *ptr += strlen(*ptr);
<a name="l00171"></a>00171         <span class="keywordflow">else</span> {
<a name="l00172"></a>00172                 <span class="keywordtype">size_t</span> len;
<a name="l00173"></a>00173                 *ptr = foo + 1;
<a name="l00174"></a>00174                 *foo = 0;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                 len = strlen(res);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178                 <span class="keywordflow">if</span> (len &gt; 1 &amp;&amp; res[len - 1] == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l00179"></a>00179                         res[len - 1] = 0;
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="keywordflow">return</span> res;
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00197"></a>00197 <span class="keywordtype">char</span> *gg_read_line(<span class="keywordtype">int</span> sock, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> length)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199         <span class="keywordtype">int</span> ret;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (!buf || length &lt; 0)
<a name="l00202"></a>00202                 <span class="keywordflow">return</span> NULL;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="keywordflow">for</span> (; length &gt; 1; buf++, length--) {
<a name="l00205"></a>00205                 <span class="keywordflow">do</span> {
<a name="l00206"></a>00206                         <span class="keywordflow">if</span> ((ret = read(sock, buf, 1)) == -1 &amp;&amp; errno != EINTR &amp;&amp; errno != EAGAIN) {
<a name="l00207"></a>00207                                 gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_read_line() error on read (errno=%d, %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00208"></a>00208                                 *buf = 0;
<a name="l00209"></a>00209                                 <span class="keywordflow">return</span> NULL;
<a name="l00210"></a>00210                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret == 0) {
<a name="l00211"></a>00211                                 gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_read_line() eof reached\n&quot;</span>);
<a name="l00212"></a>00212                                 *buf = 0;
<a name="l00213"></a>00213                                 <span class="keywordflow">return</span> NULL;
<a name="l00214"></a>00214                         }
<a name="l00215"></a>00215                 } <span class="keywordflow">while</span> (ret == -1 &amp;&amp; (errno == EINTR || errno == EAGAIN));
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> (*buf == <span class="charliteral">&#39;\n&#39;</span>) {
<a name="l00218"></a>00218                         buf++;
<a name="l00219"></a>00219                         <span class="keywordflow">break</span>;
<a name="l00220"></a>00220                 }
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         *buf = 0;
<a name="l00224"></a>00224         <span class="keywordflow">return</span> buf;
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00238"></a>00238 <span class="keywordtype">int</span> gg_connect(<span class="keywordtype">void</span> *addr, <span class="keywordtype">int</span> <a class="code" href="structgg__session.html#ab35f009229ac56f118173cbe0e0900ec">port</a>, <span class="keywordtype">int</span> async)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240         <span class="keywordtype">int</span> sock, one = 1, errno2;
<a name="l00241"></a>00241         <span class="keyword">struct </span>sockaddr_in sin;
<a name="l00242"></a>00242         <span class="keyword">struct </span>in_addr *a = addr;
<a name="l00243"></a>00243         <span class="keyword">struct </span>sockaddr_in myaddr;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         gg_debug(<a class="code" href="libgadu_8h.html#a3370765722a4297e9cfdf876dad7f492">GG_DEBUG_FUNCTION</a>, <span class="stringliteral">&quot;** gg_connect(%s, %d, %d);\n&quot;</span>, inet_ntoa(*a), port, async);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <span class="keywordflow">if</span> ((sock = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)) == -1) {
<a name="l00248"></a>00248                 gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_connect() socket() failed (errno=%d, %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00249"></a>00249                 <span class="keywordflow">return</span> -1;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         memset(&amp;myaddr, 0, <span class="keyword">sizeof</span>(myaddr));
<a name="l00253"></a>00253         myaddr.sin_family = AF_INET;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255         myaddr.sin_addr.s_addr = <a class="code" href="libgadu_8c.html#a3278b666b85b4572e32025ca40d2b10b">gg_local_ip</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (bind(sock, (<span class="keyword">struct</span> sockaddr *) &amp;myaddr, <span class="keyword">sizeof</span>(myaddr)) == -1) {
<a name="l00258"></a>00258                 gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_connect() bind() failed (errno=%d, %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00259"></a>00259                 errno2 = errno;
<a name="l00260"></a>00260                 close(sock);
<a name="l00261"></a>00261                 errno = errno2;
<a name="l00262"></a>00262                 <span class="keywordflow">return</span> -1;
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (async) {
<a name="l00266"></a>00266 <span class="preprocessor">#ifdef FIONBIO</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (ioctl(sock, FIONBIO, &amp;one) == -1) {
<a name="l00268"></a>00268 <span class="preprocessor">#else</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (fcntl(sock, F_SETFL, O_NONBLOCK) == -1) {
<a name="l00270"></a>00270 <span class="preprocessor">#endif</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>                        gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_connect() ioctl() failed (errno=%d, %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00272"></a>00272                         errno2 = errno;
<a name="l00273"></a>00273                         close(sock);
<a name="l00274"></a>00274                         errno = errno2;
<a name="l00275"></a>00275                         <span class="keywordflow">return</span> -1;
<a name="l00276"></a>00276                 }
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         memset(&amp;sin, 0, <span class="keyword">sizeof</span>(sin));
<a name="l00280"></a>00280         sin.sin_port = htons(port);
<a name="l00281"></a>00281         sin.sin_family = AF_INET;
<a name="l00282"></a>00282         sin.sin_addr.s_addr = a-&gt;s_addr;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (connect(sock, (<span class="keyword">struct</span> sockaddr*) &amp;sin, <span class="keyword">sizeof</span>(sin)) == -1) {
<a name="l00285"></a>00285                 <span class="keywordflow">if</span> (errno &amp;&amp; (!async || errno != EINPROGRESS)) {
<a name="l00286"></a>00286                         gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_connect() connect() failed (errno=%d, %s)\n&quot;</span>, errno, strerror(errno));
<a name="l00287"></a>00287                         errno2 = errno;
<a name="l00288"></a>00288                         close(sock);
<a name="l00289"></a>00289                         errno = errno2;
<a name="l00290"></a>00290                         <span class="keywordflow">return</span> -1;
<a name="l00291"></a>00291                 }
<a name="l00292"></a>00292                 gg_debug(<a class="code" href="libgadu_8h.html#a40e449afb3f941037e1227afe28ddace">GG_DEBUG_MISC</a>, <span class="stringliteral">&quot;// gg_connect() connect() in progress\n&quot;</span>);
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="keywordflow">return</span> sock;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00307"></a>00307 <span class="keywordtype">void</span> gg_chomp(<span class="keywordtype">char</span> *line)
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309         <span class="keywordtype">int</span> len;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="keywordflow">if</span> (!line)
<a name="l00312"></a>00312                 <span class="keywordflow">return</span>;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         len = strlen(line);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; line[len - 1] == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00317"></a>00317                 line[--len] = 0;
<a name="l00318"></a>00318         <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; line[len - 1] == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l00319"></a>00319                 line[--len] = 0;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00335"></a>00335 <span class="keywordtype">char</span> *gg_urlencode(<span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337         <span class="keywordtype">char</span> *q, *buf;
<a name="l00338"></a>00338         <span class="keyword">const</span> <span class="keywordtype">char</span> hex[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;
<a name="l00339"></a>00339         <span class="keyword">const</span> <span class="keywordtype">char</span> *p;
<a name="l00340"></a>00340         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = 0;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         <span class="keywordflow">if</span> (!str)
<a name="l00343"></a>00343                 str = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345         <span class="keywordflow">for</span> (p = str; *p; p++, size++) {
<a name="l00346"></a>00346                 <span class="keywordflow">if</span> (!((*p &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;z&#39;</span>) || (*p &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;Z&#39;</span>) || (*p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>) || *p == <span class="charliteral">&#39; &#39;</span>) || (*p == <span class="charliteral">&#39;@&#39;</span>) || (*p == <span class="charliteral">&#39;.&#39;</span>) || (*p == <span class="charliteral">&#39;-&#39;</span>))
<a name="l00347"></a>00347                         size += 2;
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         <span class="keywordflow">if</span> (!(buf = malloc(size + 1)))
<a name="l00351"></a>00351                 <span class="keywordflow">return</span> NULL;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         <span class="keywordflow">for</span> (p = str, q = buf; *p; p++, q++) {
<a name="l00354"></a>00354                 <span class="keywordflow">if</span> ((*p &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;z&#39;</span>) || (*p &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;Z&#39;</span>) || (*p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>) || (*p == <span class="charliteral">&#39;@&#39;</span>) || (*p == <span class="charliteral">&#39;.&#39;</span>) || (*p == <span class="charliteral">&#39;-&#39;</span>))
<a name="l00355"></a>00355                         *q = *p;
<a name="l00356"></a>00356                 <span class="keywordflow">else</span> {
<a name="l00357"></a>00357                         <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39; &#39;</span>)
<a name="l00358"></a>00358                                 *q = <span class="charliteral">&#39;+&#39;</span>;
<a name="l00359"></a>00359                         <span class="keywordflow">else</span> {
<a name="l00360"></a>00360                                 *q++ = <span class="charliteral">&#39;%&#39;</span>;
<a name="l00361"></a>00361                                 *q++ = hex[*p &gt;&gt; 4 &amp; 15];
<a name="l00362"></a>00362                                 *q = hex[*p &amp; 15];
<a name="l00363"></a>00363                         }
<a name="l00364"></a>00364                 }
<a name="l00365"></a>00365         }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         *q = 0;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369         <span class="keywordflow">return</span> buf;
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00386"></a>00386 <span class="keywordtype">int</span> gg_http_hash(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a, c, i, j;
<a name="l00389"></a>00389         va_list ap;
<a name="l00390"></a>00390         <span class="keywordtype">int</span> b = -1;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         va_start(ap, format);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         <span class="keywordflow">for</span> (j = 0; j &lt; strlen(format); j++) {
<a name="l00395"></a>00395                 <span class="keywordtype">char</span> *arg, buf[16];
<a name="l00396"></a>00396 
<a name="l00397"></a>00397                 <span class="keywordflow">if</span> (format[j] == <span class="charliteral">&#39;u&#39;</span>) {
<a name="l00398"></a>00398                         snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, va_arg(ap, <a class="code" href="libgadu_8h.html#a33f630ba74294027f9bcda26ed49cdc8">uin_t</a>));
<a name="l00399"></a>00399                         arg = buf;
<a name="l00400"></a>00400                 } <span class="keywordflow">else</span> {
<a name="l00401"></a>00401                         <span class="keywordflow">if</span> (!(arg = va_arg(ap, <span class="keywordtype">char</span>*)))
<a name="l00402"></a>00402                                 arg = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00403"></a>00403                 }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405                 i = 0;
<a name="l00406"></a>00406                 <span class="keywordflow">while</span> ((c = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) arg[i++]) != 0) {
<a name="l00407"></a>00407                         a = (c ^ b) + (c &lt;&lt; 8);
<a name="l00408"></a>00408                         b = (a &gt;&gt; 24) | (a &lt;&lt; 8);
<a name="l00409"></a>00409                 }
<a name="l00410"></a>00410         }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412         va_end(ap);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414         <span class="keywordflow">return</span> (b &lt; 0 ? -b : b);
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00420"></a>00420 <span class="keyword">static</span> <span class="keywordtype">char</span> gg_base64_charset[] =
<a name="l00421"></a>00421         <span class="stringliteral">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;
<a name="l00422"></a>00422 
<a name="l00434"></a>00434 <span class="keywordtype">char</span> *gg_base64_encode(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436         <span class="keywordtype">char</span> *out, *res;
<a name="l00437"></a>00437         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0, j = 0, k = 0, len = strlen(buf);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         res = out = malloc((len / 3 + 1) * 4 + 2);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="keywordflow">if</span> (!res)
<a name="l00442"></a>00442                 <span class="keywordflow">return</span> NULL;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="keywordflow">while</span> (j &lt;= len) {
<a name="l00445"></a>00445                 <span class="keywordflow">switch</span> (i % 4) {
<a name="l00446"></a>00446                         <span class="keywordflow">case</span> 0:
<a name="l00447"></a>00447                                 k = (buf[j] &amp; 252) &gt;&gt; 2;
<a name="l00448"></a>00448                                 <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                         <span class="keywordflow">case</span> 1:
<a name="l00450"></a>00450                                 <span class="keywordflow">if</span> (j &lt; len)
<a name="l00451"></a>00451                                         k = ((buf[j] &amp; 3) &lt;&lt; 4) | ((buf[j + 1] &amp; 240) &gt;&gt; 4);
<a name="l00452"></a>00452                                 <span class="keywordflow">else</span>
<a name="l00453"></a>00453                                         k = (buf[j] &amp; 3) &lt;&lt; 4;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455                                 j++;
<a name="l00456"></a>00456                                 <span class="keywordflow">break</span>;
<a name="l00457"></a>00457                         <span class="keywordflow">case</span> 2:
<a name="l00458"></a>00458                                 <span class="keywordflow">if</span> (j &lt; len)
<a name="l00459"></a>00459                                         k = ((buf[j] &amp; 15) &lt;&lt; 2) | ((buf[j + 1] &amp; 192) &gt;&gt; 6);
<a name="l00460"></a>00460                                 <span class="keywordflow">else</span>
<a name="l00461"></a>00461                                         k = (buf[j] &amp; 15) &lt;&lt; 2;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463                                 j++;
<a name="l00464"></a>00464                                 <span class="keywordflow">break</span>;
<a name="l00465"></a>00465                         <span class="keywordflow">case</span> 3:
<a name="l00466"></a>00466                                 k = buf[j++] &amp; 63;
<a name="l00467"></a>00467                                 <span class="keywordflow">break</span>;
<a name="l00468"></a>00468                 }
<a name="l00469"></a>00469                 *out++ = gg_base64_charset[k];
<a name="l00470"></a>00470                 i++;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473         <span class="keywordflow">if</span> (i % 4)
<a name="l00474"></a>00474                 <span class="keywordflow">for</span> (j = 0; j &lt; 4 - (i % 4); j++, out++)
<a name="l00475"></a>00475                         *out = <span class="charliteral">&#39;=&#39;</span>;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         *out = 0;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479         <span class="keywordflow">return</span> res;
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00493"></a>00493 <span class="keywordtype">char</span> *gg_base64_decode(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf)
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495         <span class="keywordtype">char</span> *res, *save, *foo, val;
<a name="l00496"></a>00496         <span class="keyword">const</span> <span class="keywordtype">char</span> *end;
<a name="l00497"></a>00497         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="keywordflow">if</span> (!buf)
<a name="l00500"></a>00500                 <span class="keywordflow">return</span> NULL;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         save = res = calloc(1, (strlen(buf) / 4 + 1) * 3 + 2);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="keywordflow">if</span> (!save)
<a name="l00505"></a>00505                 <span class="keywordflow">return</span> NULL;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         end = buf + strlen(buf);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509         <span class="keywordflow">while</span> (*buf &amp;&amp; buf &lt; end) {
<a name="l00510"></a>00510                 <span class="keywordflow">if</span> (*buf == <span class="charliteral">&#39;\r&#39;</span> || *buf == <span class="charliteral">&#39;\n&#39;</span>) {
<a name="l00511"></a>00511                         buf++;
<a name="l00512"></a>00512                         <span class="keywordflow">continue</span>;
<a name="l00513"></a>00513                 }
<a name="l00514"></a>00514                 <span class="keywordflow">if</span> (!(foo = strchr(gg_base64_charset, *buf)))
<a name="l00515"></a>00515                         foo = gg_base64_charset;
<a name="l00516"></a>00516                 val = (int)(foo - gg_base64_charset);
<a name="l00517"></a>00517                 buf++;
<a name="l00518"></a>00518                 <span class="keywordflow">switch</span> (index) {
<a name="l00519"></a>00519                         <span class="keywordflow">case</span> 0:
<a name="l00520"></a>00520                                 *res |= val &lt;&lt; 2;
<a name="l00521"></a>00521                                 <span class="keywordflow">break</span>;
<a name="l00522"></a>00522                         <span class="keywordflow">case</span> 1:
<a name="l00523"></a>00523                                 *res++ |= val &gt;&gt; 4;
<a name="l00524"></a>00524                                 *res |= val &lt;&lt; 4;
<a name="l00525"></a>00525                                 <span class="keywordflow">break</span>;
<a name="l00526"></a>00526                         <span class="keywordflow">case</span> 2:
<a name="l00527"></a>00527                                 *res++ |= val &gt;&gt; 2;
<a name="l00528"></a>00528                                 *res |= val &lt;&lt; 6;
<a name="l00529"></a>00529                                 <span class="keywordflow">break</span>;
<a name="l00530"></a>00530                         <span class="keywordflow">case</span> 3:
<a name="l00531"></a>00531                                 *res++ |= val;
<a name="l00532"></a>00532                                 <span class="keywordflow">break</span>;
<a name="l00533"></a>00533                 }
<a name="l00534"></a>00534                 index++;
<a name="l00535"></a>00535                 index %= 4;
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537         *res = 0;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539         <span class="keywordflow">return</span> save;
<a name="l00540"></a>00540 }
<a name="l00541"></a>00541 
<a name="l00551"></a>00551 <span class="keywordtype">char</span> *gg_proxy_auth(<span class="keywordtype">void</span>)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553         <span class="keywordtype">char</span> *tmp, *enc, *out;
<a name="l00554"></a>00554         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp_size;
<a name="l00555"></a>00555 
<a name="l00556"></a>00556         <span class="keywordflow">if</span> (!<a class="code" href="libgadu_8c.html#aac1649ba1fcd3f24f01e16c99d84e799">gg_proxy_enabled</a> || !<a class="code" href="libgadu_8c.html#a0ad8a852bfbad89e2ddc9da2cf9b0587">gg_proxy_username</a> || !<a class="code" href="libgadu_8c.html#a594e0828d76b991763610b55a3c398b2">gg_proxy_password</a>)
<a name="l00557"></a>00557                 <span class="keywordflow">return</span> NULL;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559         <span class="keywordflow">if</span> (!(tmp = malloc((tmp_size = strlen(<a class="code" href="libgadu_8c.html#a0ad8a852bfbad89e2ddc9da2cf9b0587">gg_proxy_username</a>) + strlen(<a class="code" href="libgadu_8c.html#a594e0828d76b991763610b55a3c398b2">gg_proxy_password</a>) + 2))))
<a name="l00560"></a>00560                 <span class="keywordflow">return</span> NULL;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562         snprintf(tmp, tmp_size, <span class="stringliteral">&quot;%s:%s&quot;</span>, <a class="code" href="libgadu_8c.html#a0ad8a852bfbad89e2ddc9da2cf9b0587">gg_proxy_username</a>, <a class="code" href="libgadu_8c.html#a594e0828d76b991763610b55a3c398b2">gg_proxy_password</a>);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (!(enc = gg_base64_encode(tmp))) {
<a name="l00565"></a>00565                 free(tmp);
<a name="l00566"></a>00566                 <span class="keywordflow">return</span> NULL;
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         free(tmp);
<a name="l00570"></a>00570 
<a name="l00571"></a>00571         <span class="keywordflow">if</span> (!(out = malloc(strlen(enc) + 40))) {
<a name="l00572"></a>00572                 free(enc);
<a name="l00573"></a>00573                 <span class="keywordflow">return</span> NULL;
<a name="l00574"></a>00574         }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         snprintf(out, strlen(enc) + 40,  <span class="stringliteral">&quot;Proxy-Authorization: Basic %s\r\n&quot;</span>, enc);
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         free(enc);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580         <span class="keywordflow">return</span> out;
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00586"></a>00586 <span class="keyword">static</span> <span class="keyword">const</span> uint32_t gg_crc32_table[256] =
<a name="l00587"></a>00587 {
<a name="l00588"></a>00588         0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 
<a name="l00589"></a>00589         0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3, 
<a name="l00590"></a>00590         0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988, 
<a name="l00591"></a>00591         0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91, 
<a name="l00592"></a>00592         0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de, 
<a name="l00593"></a>00593         0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7, 
<a name="l00594"></a>00594         0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 
<a name="l00595"></a>00595         0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5, 
<a name="l00596"></a>00596         0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172, 
<a name="l00597"></a>00597         0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b, 
<a name="l00598"></a>00598         0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 
<a name="l00599"></a>00599         0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59, 
<a name="l00600"></a>00600         0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 
<a name="l00601"></a>00601         0x21b4f4b5, 0x56b3c423, 0xcfba9599, 0xb8bda50f, 
<a name="l00602"></a>00602         0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924, 
<a name="l00603"></a>00603         0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d, 
<a name="l00604"></a>00604         0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a, 
<a name="l00605"></a>00605         0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433, 
<a name="l00606"></a>00606         0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 
<a name="l00607"></a>00607         0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01, 
<a name="l00608"></a>00608         0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e, 
<a name="l00609"></a>00609         0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457, 
<a name="l00610"></a>00610         0x65b0d9c6, 0x12b7e950, 0x8bbeb8ea, 0xfcb9887c, 
<a name="l00611"></a>00611         0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65, 
<a name="l00612"></a>00612         0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2, 
<a name="l00613"></a>00613         0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb, 
<a name="l00614"></a>00614         0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0, 
<a name="l00615"></a>00615         0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9, 
<a name="l00616"></a>00616         0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086, 
<a name="l00617"></a>00617         0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f, 
<a name="l00618"></a>00618         0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 
<a name="l00619"></a>00619         0x59b33d17, 0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad, 
<a name="l00620"></a>00620         0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a, 
<a name="l00621"></a>00621         0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683, 
<a name="l00622"></a>00622         0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8, 
<a name="l00623"></a>00623         0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1, 
<a name="l00624"></a>00624         0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 
<a name="l00625"></a>00625         0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7, 
<a name="l00626"></a>00626         0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc, 
<a name="l00627"></a>00627         0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5, 
<a name="l00628"></a>00628         0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252, 
<a name="l00629"></a>00629         0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b, 
<a name="l00630"></a>00630         0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60, 
<a name="l00631"></a>00631         0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79, 
<a name="l00632"></a>00632         0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236, 
<a name="l00633"></a>00633         0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f, 
<a name="l00634"></a>00634         0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 
<a name="l00635"></a>00635         0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d, 
<a name="l00636"></a>00636         0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 
<a name="l00637"></a>00637         0x9c0906a9, 0xeb0e363f, 0x72076785, 0x05005713, 
<a name="l00638"></a>00638         0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38, 
<a name="l00639"></a>00639         0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21, 
<a name="l00640"></a>00640         0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e, 
<a name="l00641"></a>00641         0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777, 
<a name="l00642"></a>00642         0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 
<a name="l00643"></a>00643         0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45, 
<a name="l00644"></a>00644         0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2, 
<a name="l00645"></a>00645         0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db, 
<a name="l00646"></a>00646         0xaed16a4a, 0xd9d65adc, 0x40df0b66, 0x37d83bf0, 
<a name="l00647"></a>00647         0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9, 
<a name="l00648"></a>00648         0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 
<a name="l00649"></a>00649         0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf, 
<a name="l00650"></a>00650         0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94, 
<a name="l00651"></a>00651         0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d
<a name="l00652"></a>00652 };
<a name="l00653"></a>00653 
<a name="l00664"></a><a class="code" href="libgadu_8h.html#a1674418e6048446e8279a62eb23d483f">00664</a> uint32_t <a class="code" href="common_8c.html#a1674418e6048446e8279a62eb23d483f">gg_crc32</a>(uint32_t crc, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> len)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666         <span class="keywordflow">if</span> (buf == NULL || len &lt; 0)
<a name="l00667"></a>00667                 <span class="keywordflow">return</span> crc;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         crc ^= 0xffffffffL;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671         <span class="keywordflow">while</span> (len--)
<a name="l00672"></a>00672                 crc = (crc &gt;&gt; 8) ^ gg_crc32_table[(crc ^ *buf++) &amp; 0xff];
<a name="l00673"></a>00673 
<a name="l00674"></a>00674         <span class="keywordflow">return</span> crc ^ 0xffffffffL;
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 <span class="comment">/*</span>
<a name="l00678"></a>00678 <span class="comment"> * Local variables:</span>
<a name="l00679"></a>00679 <span class="comment"> * c-indentation-style: k&amp;r</span>
<a name="l00680"></a>00680 <span class="comment"> * c-basic-offset: 8</span>
<a name="l00681"></a>00681 <span class="comment"> * indent-tabs-mode: notnil</span>
<a name="l00682"></a>00682 <span class="comment"> * End:</span>
<a name="l00683"></a>00683 <span class="comment"> *</span>
<a name="l00684"></a>00684 <span class="comment"> * vim: shiftwidth=8:</span>
<a name="l00685"></a>00685 <span class="comment"> */</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="common_8c.html">common.c</a>      </li>
      <li class="footer">Generated on Sun Mar 24 2013 16:05:11 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
